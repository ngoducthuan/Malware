<<<<<<< HEAD
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <gmp.h>
#include "generate_key.h"
// gcc rsa.c generate_key.c -o rsa.exe -lgmp để cho phép liên kết hai file
// Define the structure for RSA keys
struct RSAKeys {
    int encode_key;
    int decode_key;
    int n;
};

// Declaration of keys and n
mpz_t encode_key;
mpz_t decode_key;
mpz_t n;

// Function to initialize keys and n
void initialize_keys() {
    struct RSAKeys keys = generate_keys();

    mpz_init_set_ui(encode_key, keys.decode_key);
    mpz_init_set_ui(decode_key, keys.encode_key);
    mpz_init_set_ui(n, keys.n);
}

// Function to clean up keys and n
void clear_keys() {
    mpz_clear(encode_key);
    mpz_clear(decode_key);
    mpz_clear(n);
}

// Function to encode a message
void encode(char *message, mpz_t *encoded_message) {
    // Iterate through each character in the message
    int i;
    for (i = 0; i < strlen(message); i++) {
        // Encode each character and store it in the result array
        mpz_init(encoded_message[i]);// Initialize a variable from the GMP library to store the encoded value of the character. 
        mpz_set_ui(encoded_message[i], message[i]); // Set the value of the encoded_message[i] variable
        mpz_powm_ui(encoded_message[i], encoded_message[i], mpz_get_ui(encode_key), n); // Used for modular exponentiation.
        // encoded_message[i] the base value for the exponentiation operation.  
        // encoded_message[i] variable where the result of the exponentiation operation will be stored. 
        // mpz_get_ui(encode_key): This function retrieves the unsigned integer value of the encode_key variable.
        // n: This is the modulus used in the modular exponentiation operation.
    }
}

// Function to decode a message
void decode(mpz_t *encode_list, int length, char *decoded_message) {
    // Iterate through each encoded character
    int i;
    for (i = 0; i < length; i++) {
        // Decode each character and store it in the result array
        mpz_powm_ui(encode_list[i], encode_list[i], mpz_get_ui(decode_key), n);
        decoded_message[i] = mpz_get_ui(encode_list[i]);
    }
    // Null-terminate the string
    decoded_message[length] = '\0';
}

int main() {
    // Message to be encoded
    char *message = "Nguyen Binh Nam";
    // Calculate the length of the message
    int length = strlen(message);
    // Array to store the encoded message
    mpz_t encode_message[length];
    // Array to store the decoded message
    char decode_message[length + 1]; // +1 for null terminator

    // Initialize keys and n
    initialize_keys();

    // Encode the message
    encode(message, encode_message);
    // Print the encoded message
    printf("Encoded message: ");
    int i;
    for (i = 0; i < length; i++) {
        gmp_printf("%Zd ", encode_message[i]);
    }
    printf("\n");

    // Decode the message
    decode(encode_message, length, decode_message);
    // Print the decoded message
    printf("Decoded message: %s\n", decode_message);

    // Clean up keys and n
    clear_keys();

    return 0;
}
=======

>>>>>>> c8e030381513f6f306739bf22eabd3a1b0a60f43
