//Compiler using gcc client.c -o client.exe -lws2_32
//Create TCP socket.
//Connect newly created client socket to server.
#include <stdio.h>
#include <stdlib.h>//exit()
//#include <sys/socket.h>// Definitions for network programming functions like socket, bind, listen, and more.
//Two function to Fix bug AF_INET, SOCK_STREAM and server
#include <winsock2.h>//The socket function is declared in <winsock2.h>.
#include <ws2tcpip.h>//This header file primarily defines structures and constants related to network addressing, such as struct sockaddr_in for IPv4 addresses.
//Communicate between Client and Server
#include <strings.h>//Declaration for bzero funtion
#include <string.h>
#include <unistd.h> // Include for close()

//Function to send message


//Main function
int main(){
    WSADATA wsaData;
    int socket_data;
    char message[1024] = "", s_message[100]= "";
    struct sockaddr_in server_addr, client_addr;

    // Initialize Winsock
    if (WSAStartup(MAKEWORD(2, 2), &wsaData) != 0) {
        printf("WSAStartup failed: %d\n", WSAGetLastError());
        return 1;
    }
    //Creat socket and assign value to server structure
    socket_data = socket(AF_INET, SOCK_STREAM, 0);
    if(socket_data < 0){
        printf("[-] Create socket failure.\n");
        exit(1);
    }else{
        printf("[+] TCP server socket created.\n");
    }
    //Assign IP and Port
    server_addr.sin_family = AF_INET;
    //Port to connect wwith server(Server sẽ mở một vài cổng mặc định để nhận kết nối từ client)
    server_addr.sin_port = htons(8080); // Port number in network byte order2000;
    server_addr.sin_addr.s_addr = inet_addr("127.0.0.1");
    //Connect to Server
   
    connect(socket_data, (struct sockaddr *)&server_addr, sizeof server_addr);//&server là truyền tham chiếu dereferencing pointer (struct sockaddr *) là ép kiểu
    if(socket_data == -1){
        printf("Connect failed...\n");
        exit(0);
    }else{
        printf("Connect successful...\n");
    }
    //Send message to server and wait for the reply
    memset(message, 0, 1024);
    strcpy(message, "Hello, My name is Thuan.");
    printf("Client: %s\n", message);
    send(socket_data, message, strlen(message), 0);
    //Receive the reply from the server
    //The memset function is used to fill a block of memory with a particular value. 
    //It's commonly used to initialize memory areas, such as arrays, to a specific value, often zero.
    //Set 0 to representation of the byte value you want to set (e.g., 0 for zeroing out memory).
    //Using replace bzero
    memset(message, 0, 1024);
    recv(socket_data, message, sizeof(message), 0);
    printf("Server: %s\n", message);
    //Close socket
    close(socket_data);
    printf("Disconnected to server.");
    // Cleanup Winsock
    WSACleanup();

    return 0;
}
